<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Synchronisation - Ubiq Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Synchronisation";
        var mkdocs_page_input_path = "synchronisation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Ubiq Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../gettingubiq/">Getting Ubiq</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settingupvr/">Setting Up VR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../creatinganetworkedobject/">Creating Networked Objects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../spawningobjects/">Object Spawning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../localloopback/">Testing with Local Loopback</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Synchronisation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#try-out-your-prefab">Try out your Prefab</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ownership">Ownership</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#spawning">Spawning</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ubiqxrinteraction/">Interaction with Ubiq XR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../serversandrooms/">Servers and Rooms</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../eventlogginggettingstarted/">Logging</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../3dpentutorial/">Creating a 3D Pen</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../serversetup/">Server</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../xrinteraction/">Interaction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Logging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../eventlogging/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloganalysis/">Analysis</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloggingexperimentquestionnaire/">Questionnaire</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloggingunittests/">Unit Tests</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloggingcollectorservice/">LogCollector Service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventlogserialisation/">Serialisation and Memory</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Messaging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../messaging/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../networkids/">Network Ids</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../generatinguniqueids/">Generating Unique Ids</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../networkidtype/">Types</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../reservedids/">Reserved IDs</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../webrtc/">WebRtc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Servers and Rooms</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../serverintroduction/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../serveroverview/">Server Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../serverheartbeat/">Heartbeat and Timeouts</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../leavingandjoiningrooms/">Leaving and Joining</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../botssample/">Bots</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Programming</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../asyncdesignpatterns/">Async Design Patterns</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nexus/">Nexus</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mkdocs/">Meta</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Ubiq Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Getting Started</li>
      <li class="breadcrumb-item active">Synchronisation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="synchronisation">Synchronisation</h1>
<h3 id="try-out-your-prefab">Try out your Prefab</h3>
<p>Add a copy of your Prefab from the first tutorial page into each Forest and press Play.</p>
<p><img alt="" src="../images/5c0ae85b-b9b2-4595-b3ab-6b5809138426.png" /></p>
<p>Drag one of your GameObjects around, and see it change in the other scene. Try and drag the second instance around, and see the first one change position.</p>
<p>Your MyNetworkedObject Component synchronises the object's positions by looking for <em>external</em> changes each frame. This achieved in the <code>Update</code> method:</p>
<pre><code>if(lastPosition != transform.localPosition)
{
    lastPosition = transform.localPosition;
    context.SendJson(new Message()
    {
        position = transform.localPosition
    });
}
</code></pre>
<p>If the position doesn't change within a frame, then no updates are sent.</p>
<p>The position only changes in one of two ways:</p>
<ol>
<li>Something outside the script moves the object in <em>this Peer</em>.</li>
<li>A message from another instance moves the object.</li>
</ol>
<p>In the second case, the position is updated but no message is sent, because it means something moved the object in <em>another Peer</em>.</p>
<h3 id="ownership">Ownership</h3>
<p>This approach of sending only local changes is simple, but isn't perfect.</p>
<p>Have a friend join a Room containing your object, and see what happens when you both try and move it at the same time.</p>
<p>In networked environments, two users can try to change the same thing at the same time. How those conflicts are resolved is up to you. </p>
<p>Another straightforward approach is to use Ownership Based Synchronisation.</p>
<p>In this case, a variable specifies who "owns" an object. Only the owner can send updates, and all other instances only receive them. This is how the Firework example is implemented:</p>
<pre><code>private void Update()
{
    if(attached)
    {
        transform.position = attached.transform.position;
        transform.rotation = attached.transform.rotation;
    }
    if(owner)
    {
        context.SendJson(new Message(transform, fired));
    }
    if(owner &amp;&amp; fired)
    {
        body.isKinematic = false;
        body.AddForce(transform.up * 0.75f, ForceMode.Force);

        if (!particles.isPlaying)
        {
            particles.Play();
            body.AddForce(new Vector3(Random.value, Random.value, Random.value) * 1.1f, ForceMode.Force);
        }
    }
    if(!owner &amp;&amp; fired)
    {
        if (!particles.isPlaying)
        {
            particles.Play();
        }
    }
}
</code></pre>
<p>See how the behaviour of the script changes depending on the state of the <code>owner</code> flag. Only the owner can apply forces to the object, or send its position onto the network. Other instances simply attempt to make their local object match the state sent to them by the owner.</p>
<h3 id="spawning">Spawning</h3>
<p>When you create your own objects, you (or your code) decides which instance is the owner.</p>
<p>For example, in the case of the Firework, the Fireworks Box sets the Owner flag when it spawns the object.</p>
<p>Since the <code>Owner</code> flag defaults to <code>false</code>, spawned objects on remote instances will have this set to <code>false</code> and all objects will be configured correctly.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../localloopback/" class="btn btn-neutral float-left" title="Testing with Local Loopback"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ubiqxrinteraction/" class="btn btn-neutral float-right" title="Interaction with Ubiq XR">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../localloopback/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ubiqxrinteraction/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
