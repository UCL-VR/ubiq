<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Object Spawning - Ubiq Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Object Spawning";
        var mkdocs_page_input_path = "spawningobjects.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Ubiq Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../gettingubiq/">Getting Ubiq</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settingupvr/">Setting Up VR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../creatinganetworkedobject/">Creating Networked Objects</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Object Spawning</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#creating-spawnable-objects">Creating Spawnable Objects</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../localloopback/">Testing with Local Loopback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../synchronisation/">Synchronisation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ubiqxrinteraction/">Interaction with Ubiq XR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../serversandrooms/">Servers and Rooms</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../eventlogginggettingstarted/">Logging</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../3dpentutorial/">Creating a 3D Pen</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../serversetup/">Server</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../xrinteraction/">Interaction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Logging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../eventlogging/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloganalysis/">Analysis</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloggingexperimentquestionnaire/">Questionnaire</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloggingunittests/">Unit Tests</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventloggingcollectorservice/">LogCollector Service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../eventlogserialisation/">Serialisation and Memory</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Messaging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../messaging/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../networkids/">Network Ids</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../generatinguniqueids/">Generating Unique Ids</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../networkidtype/">Types</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../reservedids/">Reserved IDs</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../webrtc/">WebRtc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Servers and Rooms</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../serverintroduction/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../serveroverview/">Server Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../serverheartbeat/">Heartbeat and Timeouts</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../leavingandjoiningrooms/">Leaving and Joining</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../botssample/">Bots</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Programming</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../asyncdesignpatterns/">Async Design Patterns</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nexus/">Nexus</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mkdocs/">Meta</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Ubiq Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Getting Started</li>
      <li class="breadcrumb-item active">Object Spawning</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="spawning-objects">Spawning Objects</h1>
<p>You can create objects at runtime on all Peers using the <code>NetworkSpawner</code>.</p>
<p><img alt="Network Spawner" src="../images/e8cae779-d00b-47ac-81f2-28f14e6b8fd8.png" /></p>
<p>Objects are spawned by calling <code>SpawnWithPeerScope()</code> or <code>SpawnWithRoomScope()</code>. The <code>NetworkSpawner</code> is static and so is accessible anywhere in the code. However, it needs a Unity <code>GameObject</code> to find the <code>NetworkScene</code> in which to spawn the object.</p>
<p>There are two Spawn methods: <code>SpawnWithPeerScope</code> and <code>SpawnWithRoomScope</code>.</p>
<ul>
<li>
<p><code>SpawnWithPeerScope</code> keeps objects around so long as the Peer that spawned them is in the room.</p>
</li>
<li>
<p><code>SpawnWithRoomScope</code> keeps objects around so long as the room exists, regardless of who created them.</p>
</li>
</ul>
<p>Rooms only exist as long as they have at least one member in them. Once all Peers leave a Room, the Room is destroyed along with all the objects within it.</p>
<p>Before a GameObject can be Spawned, it must be added to the <code>PrefabCatalogue</code> of the <code>SceneManager</code>.</p>
<p>Do this by adding a new entry to the <code>Prefab Catalogue</code> Asset in the Inspector. </p>
<p><img alt="Prefab Catalogue" src="../images/740061ba-7bfe-4832-9c97-d75e85b9e26c.png" /></p>
<p>Once the Prefab GameObject has been added it can be spawned by passing the same reference to <code>SpawnWithPeerScope</code> or <code>SpawnWithRoomScope</code>:</p>
<pre><code>public void Use(Hand controller)
{
    NetworkSpawnManager.Find(this).SpawnWithPeerScope(FireworkPrefab);
}
</code></pre>
<h3 id="creating-spawnable-objects">Creating Spawnable Objects</h3>
<p>When objects are spawned they need to be given the same network Id so they can communicate.</p>
<p>When objects are created at Design Time, this is done based on their position in the graph. When they are created at Runtime, they may not end up in the same position so this needs to be done explicitly.</p>
<p>When using the <code>NetworkSpawner</code>, Ids are assigned automatically, for every Network Object in the Prefab. For this to happen, Networked Objects must implement the <code>INetworkSpawnable</code> interface.</p>
<p>Update your networked object to use <code>Ubiq.Spawning</code>, then define <code>INetworkSpawnable</code> for your class. This interface requires you to have a property called NetworkId of the type NetworkId that can be read and written to. Create such a property with the default get and set accessors.</p>
<p>You don't have to do anything with the property - just have it in your class to satisfy <code>INetworkSpawnable</code>. Spawned instances of your object will now synchronise correctly.</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Ubiq.Messaging;
using Ubiq.Spawning;

public class MyNetworkedObject : MonoBehaviour, INetworkSpawnable
{
    public NetworkId NetworkId { get; set; }

    NetworkContext context;

    // Start is called before the first frame update
    void Start()
    {
        context = NetworkScene.Register(this);
    }

    Vector3 lastPosition;

    // Update is called once per frame
    void Update()
    {
        if(lastPosition != transform.localPosition)
        {
            lastPosition = transform.localPosition;
            context.SendJson(new Message()
            {
                position = transform.localPosition
            });
        }
    }

    private struct Message
    {
        public Vector3 position;
    }

    public void ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {
        // Parse the message
        var m = message.FromJson&lt;Message&gt;();

        // Use the message to update the Component
        transform.localPosition = m.position;

        // Make sure the logic in Update doesn't trigger as a result of this message
        lastPosition = transform.localPosition;
    }
}
</code></pre>
<p>Create a Prefab by dragging your Networked Object from the "Creating Networked Objects" tutorial into the Assets view, then add this to the Catalogue.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../creatinganetworkedobject/" class="btn btn-neutral float-left" title="Creating Networked Objects"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../localloopback/" class="btn btn-neutral float-right" title="Testing with Local Loopback">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../creatinganetworkedobject/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../localloopback/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
